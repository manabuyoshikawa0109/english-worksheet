<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>英語ワークシート</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* =============================================
    フォント設定
    ============================================= */
    @font-face {
      font-family: "CJ Gothic";
      src: url("fonts/CJ_Gothic/CJ_Gothic_2019-Regular.woff2") format("woff2"),
        url("fonts/CJ_Gothic/CJ_Gothic_2019-Regular.woff") format("woff");
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "Nunito";
      src: url("fonts/Nunito/Nunito-VariableFont_wght.ttf") format("truetype");
      font-weight: 100 900;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "Nunito";
      src: url("fonts/Nunito/Nunito-Italic-VariableFont_wght.ttf") format("truetype");
      font-weight: 100 900;
      font-style: italic;
      font-display: swap;
    }
    /* =============================================
    パーツの共通CSS
    ============================================= */
    /* input-group内のフォームは横一杯に幅を取らないようにする */
    .input-group > .form-select {
      flex: none;
      width: auto;
    }

    .input-group > input[type="color"] {
      flex: none;
      width: 50px;
    }

    /* ボタンに影をつけて立体感を出す */
    button {
      box-shadow: 0 2px 0 rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.35);
      text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
    }

    /* ボタンをクリックした時に沈み込むようにし、躍動感を出す */
    button:active {
      transform: translateY(1px);
    }

    body {
      font-family: sans-serif;
      background: #f5f5f5; /* ワークシートを囲う要素の背景色を変更 */
      display: flex; /* サイドバーとワークシートを横並びにする */
      height: 100vh;
    }

    .sidebar {
      width: 300px;
      background: #343a40;
      color: #fff;
      padding: 20px;
      overflow-y: scroll;
    }

    .sidebar h4 {
      font-size: 1rem;
    }

    .main-content {
      /* フレックスコンテナ内に余白があるとき、フレックスアイテムに指定した比率の分だけ余白を追加
      ここでは片方のフレックスアイテムに「1」を指定しているのでこのフレックスアイテムが画面右側まで伸び余白を埋める
      bodyタグがフレックスコンテナとなる */
      flex-grow: 1;
      overflow-y: scroll;
      padding: 30px;
    }

    /* =============================================
    ワークシートのCSS
    ============================================= */
    .worksheet {
      max-width: 900px;
      margin: 0 auto; /* 左右中央揃え */
      background: #fff;
      padding: 30px 40px;
      border: 1px solid #ccc;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
    }

    .worksheet-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      margin-bottom: 1rem;
    }

    .student-info {
      display: grid; /* フレックスアイテムをx、y軸方向に配置 */
      grid-template-columns: repeat(3, 80px); /* 横並びにするフレックスアイテム数とフレックスアイテムの横幅 */
      border: 1px solid #000;
    }

    .student-info-box {
      border-left: 1px solid #000;
      padding: 4px 6px;
      height: 80px;
      display: flex;
      flex-direction: column; /* フレックスアイテムを上から下に配置 */
      justify-content: space-between;
    }

    .student-info-box:first-child {
      border-left: none;
    }

    .student-info-label {
      font-size: 0.65rem;
      font-weight: bold;
    }

    .student-info-input {
      font-size: 1.5rem;
      border: none;
      background: transparent;
      width: 100%;
      padding: 0;
    }

    .student-info-input:focus {
      outline: none; /* フォームにカーソルが当たった際、輪郭線を表示しない */
    }

    .student-name-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      font-weight: bold;
      position: absolute;
      top: -1.3rem;
      left: 0;
      right: 0;
    }

    .date {
      letter-spacing: 35px; /* テキストの水平方向の字間のスペース */
    }

    .line-group {
      position: relative;
      height: 55px;
      margin-bottom: 50px;
      /* フレックスコンテナ内に余白があるとき、フレックスアイテムに指定した比率の分だけ余白を追加
      ここでは片方のフレックスアイテムに「1」を指定しているのでこのフレックスアイテムが画面右側まで伸び余白を埋める
      bodyタグがフレックスコンテナとなる */
      flex-grow: 1;
    }

    .student-name {
      margin-top: 20px;
      margin-bottom: 0 !important;
    }

    .line {
      position: absolute;
      left: 0;
      right: 0;
      height: 1px;
    }

    .line1 {
      top: 0;
    }

    .line2 {
      top: 18px;
    }

    .line3 {
      top: 36px;
    }

    .line4 {
      top: 54px;
    }

    /* 入力フォーム（scaleXで拡大縮小） */
    .line-input {
      font-size: 3rem;
      line-height: 50px;
      padding: 0 10px;
      font-family: "CJ Gothic", sans-serif;
      white-space: nowrap; /* 改行しない */
      cursor: pointer;
      min-width: 100%; /* 最低横幅は100% */
      width: fit-content; /* 横幅は入力文字の長さに合わせる */
      height: 100%;
      transform-origin: left center; /* 要素を回転や拡大・縮小する際の基点(原点) */
      transform: scaleX(1); /* 要素のX軸方向への拡大率 */
    }

    .line-input:focus {
      outline: 2px solid rgba(0, 123, 255, 0.3);
      background-color: rgba(0, 123, 255, 0.08);
    }

    .worksheet-title {
      margin-bottom: 1.4rem;
      text-align: center;
      font-weight: bold;
      font-size: 2rem;
      height: 48px;
      border-bottom: 2px solid #0b76b7;
      white-space: nowrap; /* 自動改行しない */
      overflow: hidden; /* 入力文字が横幅を超えた場合、超えた文字は表示しない */
      text-overflow: ellipsis; /* 入力文字が横幅を超えた場合、3点表示する */
      font-family: "Nunito", sans-serif;
    }

    /* =============================================
    行の拡大・縮小ボタンのCSS
    ============================================= */
    .zoom-btn {
      height: 40px;
      border: none;
      border-radius: 15px;
      color: #fff;
      font-weight: bold;
      letter-spacing: 0.5px; /* 字間のスペース */
      background: linear-gradient(180deg,
          #7db2ff 0%,
          #5b8eea 45%,
          #3a6fd6 100%);
      box-shadow: 0 2px 0 rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.35);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .zoom-btn .letter {
      font-size: 1.1rem;
    }

    .zoom-in-btn {
      margin-right: -5px;
    }

    .zoom-out-btn {
      margin-left: -5px;
    }

    .zoom-in-btn .letter {
      transform: scaleX(1.2);
    }

    .zoom-out-btn .letter {
      transform: scaleX(0.5);
    }

    .zoom-percent {
      height: 34px;
      padding: 0 5px;
      border-radius: 8px;
      background: #cfefff;
      color: #0b4a8f;
      font-weight: 800;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8),
        0 1px 0 rgba(0, 0, 0, 0.2);
      cursor: pointer;
      user-select: none;
      z-index: 1;
    }

    .zoom-percent small {
      font-weight: 700;
      font-size: 0.95rem;
    }

    /* =============================================
    タブレット対応
    ============================================= */
    @media (max-width: 768px) {
      .sidebar {
        min-width: 300px;
      }

      .worksheet {
        width: 900px;
      }
    }

    /* =============================================
    印刷対応
    ============================================= */
    @media print {
      .sidebar {
        display: none;
      }

      .main-content {
        padding: 0 !important;
      }

      .worksheet {
        margin: 0;
        border: none;
        box-shadow: none;
      }
    }
  </style>
</head>

<body>
  <div class="sidebar">

    <h4>ワークシートのタイトル</h4>
    <input type="text" id="worksheetTitleInput" class="form-control" placeholder="例）Today's weather" />

    <hr>

    <h4 class="mt-4">文字のスタイル</h4>
    <div class="d-flex align-items-center gap-2">
      <div class="input-group w-auto">
        <input type="color" id="textColor" class="form-control form-control-color" />
        <span class="input-group-text">色</span>
      </div>
      <div class="btn-group" role="group" aria-label="文字のスタイル">
        <button id="btnBold" class="btn btn-primary fw-bold" title="太字">
          B
        </button>
        <button id="btnItalic" class="btn btn-primary fst-italic" title="イタリック">
          I
        </button>
        <button id="btnUnderline" class="btn btn-primary text-decoration-underline" title="下線">
          U
        </button>
    </div>
    </div>

    <hr>

    <!-- ここはOK -->
    <h4 class="mt-4">罫線のスタイル</h4>
    <div class="input-group mb-4">
      <span class="input-group-text">第</span>
      <select id="targetLine" class="form-select">
        <option value="line1">1</option>
        <option value="line2">2</option>
        <option value="line3">3</option>
        <option value="line4">4</option>
      </select>
      <span class="input-group-text">罫線</span>
    </div>
    <div class="input-group">
      <select id="lineStyle" class="form-select">
        <option value="solid">直</option>
        <option value="dotted">点</option>
        <option value="dashed">ダッシュ</option>
      </select>
      <span class="input-group-text">線</span>
      <input id="lineColor" type="color" class="form-control form-control-color" />
      <span class="input-group-text">色</span>
    </div>

    <hr>

    <!-- ここは確認済み -->
    <h4 class="mt-4">行の幅</h4>
    <!-- <div class="d-flex align-items-center gap-2">
      <select id="targetRow" class="form-select"></select>
      <div class="d-flex align-items-center">
        <button id="zoomInBtn" class="zoom-btn zoom-in-btn" title="拡大">
          <span>←</span><span class="letter">A</span><span>→</span>
        </button>
        <div id="zoomPercent" class="zoom-percent" title="ダブルクリックで100%に戻す">
          <small id="zoomVal">100%</small>
        </div>
        <button id="zoomOutBtn" class="zoom-btn zoom-out-btn" title="縮小">
          <span>→</span><span class="letter">A</span><span>←</span>
        </button>
      </div>
    </div> -->
    <div class="input-group mb-4">
      <select id="targetRow" class="form-select"></select>
      <span class="input-group-text">行目</span>
      <input type="number" class="form-control" value="100" min="0" max="100" step="1" >
      <span class="input-group-text">%</span>
    </div>
    <input type="range" class="w-100" value="100" min="0" max="100" step="1">

    <hr>

    <!-- ここは確認済み -->
    <h4 class="mt-4">その他の操作</h4>
    <div class="d-flex align-items-center gap-2">
      <button id="printBtn" class="btn btn-primary w-50">
        <i class="fa-solid fa-print"></i>
        印刷
      </button>
      <button id="clearBtn" class="btn btn-danger w-50">
        <i class="fa-solid fa-trash"></i>
        クリア
      </button>
    </div>
  </div>

  <!-- ワークシート -->
  <div class="main-content">
    <div class="worksheet">
      <div class="worksheet-header">
        <div class="student-info">
          <div class="student-info-box">
            <div class="student-info-label">Grade</div>
            <input type="text" class="student-info-input" />
          </div>
          <div class="student-info-box">
            <div class="student-info-label">Class</div>
            <input type="text" class="student-info-input" />
          </div>
          <div class="student-info-box">
            <div class="student-info-label">No.</div>
            <input type="text" class="student-info-input" />
          </div>
        </div>

        <div class="line-group student-name">
          <div class="line line1"></div>
          <div class="line line2"></div>
          <div class="line line3"></div>
          <div class="line line4"></div>
          <div class="student-name-label">
            <span>Name</span><span>Date<span class="date"> ・・</span></span>
          </div>
          <div class="line-input" contenteditable="true"></div>
        </div>
      </div>

      <div id="worksheetTitle" class="worksheet-title"></div>
      <div class="lines-container" id="lines"></div>
    </div>
  </div>

  <!-- ✅ スクリプト -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    // 罫線スタイルの状態保持
    const lineStyles = {
      line1: { color: "#007bff", style: "solid" },
      line2: { color: "#66b3ff", style: "dotted" },
      line3: { color: "#66b3ff", style: "dotted" },
      line4: { color: "#007bff", style: "solid" },
    };
    function paintLine(lineKey) {
      const cfg = lineStyles[lineKey];
      document.querySelectorAll("." + lineKey).forEach((el) => {
        el.style.borderTop = `1px ${cfg.style} ${cfg.color}`;
      });
    }
    function syncControlsTo(lineKey) {
      const cfg = lineStyles[lineKey];
      document.getElementById("lineColor").value = cfg.color;
      document.getElementById("lineStyle").value = cfg.style;
    }
    function applyFromControls() {
      const lineKey = document.getElementById("targetLine").value;
      lineStyles[lineKey].color = document.getElementById("lineColor").value;
      lineStyles[lineKey].style = document.getElementById("lineStyle").value;
      paintLine(lineKey);
    }

    // ── 直近にフォーカスした line-input を保持 ──
    let lastActiveEditable = null;
    $(document).on("focus click keyup", ".line-input", function () {
      lastActiveEditable = this;
    });

    // 文字色（line-input の選択範囲に適用）
    const textColor = document.getElementById("textColor");
    textColor.addEventListener("input", () => {
      if (!lastActiveEditable) {
        alert("4本罫線の入力欄を選択してから操作してください。");
        return;
      }
      lastActiveEditable.focus();
      document.execCommand("styleWithCSS", false, true);
      document.execCommand("foreColor", false, textColor.value);
    });

    // ── 文字装飾（太字／斜体／下線） ──
    function runFormat(cmd) {
      if (!lastActiveEditable) {
        alert("4本罫線の入力欄を選択してから操作してください。");
        return;
      }
      lastActiveEditable.focus();
      document.execCommand("styleWithCSS", false, true);
      document.execCommand(cmd, false, null);
    }
    // mousedownで実行して選択消失を防ぐ
    document.getElementById("btnBold").addEventListener("mousedown", (e) => {
      e.preventDefault();
      runFormat("bold");
    });
    document
      .getElementById("btnItalic")
      .addEventListener("mousedown", (e) => {
        e.preventDefault();
        runFormat("italic");
      });
    document
      .getElementById("btnUnderline")
      .addEventListener("mousedown", (e) => {
        e.preventDefault();
        runFormat("underline");
      });

    $(function () {
      // 本文生成
      const numLines = 9;
      for (let i = 0; i < numLines; i++) {
        $("#lines").append(`
        <div class="line-group">
          <div class="line line1"></div>
          <div class="line line2"></div>
          <div class="line line3"></div>
          <div class="line line4"></div>
          <div class="line-input" contenteditable="true" data-scale="100"></div>
        </div>
      `);
      }

      // タイトル
      $("#worksheetTitleInput").on("input", function () {
        $("#worksheetTitle").text(this.value);
      });

      // 罫線スタイル初期化
      ["line1", "line2", "line3", "line4"].forEach(paintLine);
      syncControlsTo("line1");
      $("#targetLine").on("change", function () {
        syncControlsTo(this.value);
      });
      $("#lineColor, #lineStyle").on("input change", applyFromControls);

      // 拡大・縮小（1%刻み／0〜100%）
      const $selector = $("#targetRow");
      $(".line-input").each((i) =>
        $selector.append(`<option value="${i}">${i + 1}</option>`)
      );
      const STEP = 1,
        MIN = 0,
        MAX = 100;
      function $current() {
        return $(".line-input").eq(parseInt($selector.val(), 10) || 0);
      }
      function setPercentDisplay(p) {
        $("#zoomVal").text(`${p}%`);
      }
      function applyScale($el, percent) {
        const p = Math.max(MIN, Math.min(MAX, percent | 0));
        $el.css("transform", `scaleX(${p / 100})`).attr("data-scale", p);
        setPercentDisplay(p);
      }
      setPercentDisplay(
        parseInt($(".line-input").first().attr("data-scale"), 10) || 100
      );
      $("#zoomInBtn").on("click", () => {
        const $t = $current();
        applyScale($t, +($t.attr("data-scale") || 100) + STEP);
      });
      $("#zoomOutBtn").on("click", () => {
        const $t = $current();
        applyScale($t, +($t.attr("data-scale") || 100) - STEP);
      });
      $("#targetRow").on("change", () => {
        const p = parseInt($current().attr("data-scale") || "100", 10);
        setPercentDisplay(p);
        $current().focus();
      });
      $("#zoomPercent").on("dblclick", () => applyScale($current(), 100));

      // 全消去（文字のみ）
      $("#clearBtn").on("click", function () {
        if (
          !confirm(
            "ワークシート上の文字をすべて削除します。よろしいですか？"
          )
        )
          return;
        $("#worksheetTitleInput").val("");
        $("#worksheetTitle").text("");
        $(".worksheet .student-info-input").val("");
        $(".worksheet .line-input").each(
          function () {
            this.innerHTML = "";
          }
        );
        $(".line-input").first().focus();
      });

      // 印刷プレビュー
      $("#printBtn").on("click", function () {
        if (
          document.activeElement &&
          (document.activeElement.isContentEditable ||
            document.activeElement.tagName === "INPUT")
        ) {
          document.activeElement.blur();
        }
        setTimeout(() => window.print(), 0);
      });
    });
  </script>
</body>

</html>